# Deploying Finance Alert to Render

This guide walks you through deploying your Django app to Render's free tier.

## üöÄ Quick Start

### Prerequisites
- GitHub account with this repository pushed
- Render account (sign up at [render.com](https://render.com))
- Google Sheets service account credentials
- SMTP email credentials (optional, for sending reminders)

## üìã Deployment Steps

### 1. Prepare Your Repository

Ensure all files are committed and pushed to GitHub:

```bash
cd "C:\Users\Allan N\OneDrive\Desktop\python_introduction\notifier"
git add .
git commit -m "Prepare for Render deployment"
git push
```

### 2. Create Render Account

1. Go to [render.com](https://render.com)
2. Sign up with GitHub
3. Authorize Render to access your repositories

### 3. Deploy Using render.yaml (Recommended)

1. **In Render Dashboard:**
   - Click "New +" ‚Üí "Blueprint"
   - Connect your GitHub repository: `Nebula0999/notifier`
   - Render will automatically detect `render.yaml`
   - Click "Apply"

2. **This will create:**
   - PostgreSQL database (`finance-alert-db`)
   - Web service (`finance-alert-web`)

### 4. Configure Environment Variables

After deployment starts, go to your web service ‚Üí "Environment":

#### Required Variables (Set these manually):

```env
# Django
ALLOWED_HOSTS=your-app-name.onrender.com

# Google Sheets Service Account
TYPE=service_account
PROJECT_ID=your-project-id
PRIVATE_KEY_ID=your-private-key-id
PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYour\nPrivate\nKey\nHere\n-----END PRIVATE KEY-----\n"
CLIENT_EMAIL=your-service-account@project.iam.gserviceaccount.com
CLIENT_ID=your-client-id
CLIENT_X509_CERT_URL=https://www.googleapis.com/robot/v1/metadata/x509/your-service-account@project.iam.gserviceaccount.com

# Email Configuration (Optional - for reminders)
EMAIL_HOST=smtp.gmail.com
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=noreply@yourdomain.com

# Member Emails
SULTAN_EMAIL=sultan@example.com
BLESSING_EMAIL=blessing@example.com
CYNTHIA_EMAIL=cynthia@example.com
ALLAN_EMAIL=allan@example.com
```

**Important:** For `PRIVATE_KEY`, keep the `\n` characters - they represent newlines.

### 5. Manual Deployment (Alternative)

If not using render.yaml:

#### Step A: Create PostgreSQL Database

1. Dashboard ‚Üí "New +" ‚Üí "PostgreSQL"
2. Name: `finance-alert-db`
3. Plan: Free
4. Click "Create Database"
5. Copy the "Internal Database URL"

#### Step B: Create Web Service

1. Dashboard ‚Üí "New +" ‚Üí "Web Service"
2. Connect repository: `Nebula0999/notifier`
3. Configure:
   - **Name:** `finance-alert-web`
   - **Runtime:** Python
   - **Build Command:** `./build.sh`
   - **Start Command:** `cd finance_alert && gunicorn finance_alert.wsgi:application`
   - **Plan:** Free

4. Add environment variables (see section 4 above)

5. Click "Create Web Service"

### 6. Update Django Site Domain

After deployment:

1. Visit your app URL (e.g., `https://finance-alert-web.onrender.com`)
2. Go to Admin: `https://finance-alert-web.onrender.com/admin/`
3. Login (create superuser if needed - see below)
4. Go to "Sites" ‚Üí Click "example.com"
5. Update:
   - **Domain name:** `finance-alert-web.onrender.com`
   - **Display name:** Finance Alert
6. Save

### 7. Create Superuser (Admin Access)

Connect to your Render shell:

1. Render Dashboard ‚Üí Your web service
2. Click "Shell" tab (top right)
3. Run:
```bash
cd finance_alert
python manage.py createsuperuser
```

Follow prompts to create admin account.

## üîß Post-Deployment

### Test Your Deployment

1. **Visit homepage:** `https://your-app.onrender.com/`
2. **Check admin:** `https://your-app.onrender.com/admin/`
3. **Test Google Sheets:** Verify data wall shows contributions
4. **Test reminders (optional):**
```bash
# In Render shell
cd finance_alert
python manage.py send_daily_reminders --dry-run
```

### View Logs

- Render Dashboard ‚Üí Your service ‚Üí "Logs" tab
- Check for errors during startup or requests

### Database Migrations

If you need to run migrations manually:

```bash
# In Render shell
cd finance_alert
python manage.py migrate
```

## üîê Security Checklist

- ‚úÖ `DEBUG=False` in production
- ‚úÖ `SECRET_KEY` is auto-generated by Render
- ‚úÖ `ALLOWED_HOSTS` includes your Render domain
- ‚úÖ `.env` file is in `.gitignore`
- ‚úÖ SSL/HTTPS enabled by default
- ‚úÖ Security headers enabled (HSTS, XSS, etc.)

## üìß Setting Up Email (Gmail Example)

1. Enable 2-Factor Authentication on your Gmail
2. Generate App Password:
   - Google Account ‚Üí Security ‚Üí 2-Step Verification ‚Üí App passwords
   - Generate password for "Mail"
3. In Render environment variables:
```env
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-16-char-app-password
```

## üêõ Troubleshooting

### Application Error / 500 Error

Check logs in Render dashboard:
- Look for missing environment variables
- Check database connection
- Verify static files collected

### Static Files Not Loading

Run in Render shell:
```bash
cd finance_alert
python manage.py collectstatic --no-input
```

### Database Connection Issues

- Verify `DATABASE_URL` is automatically set
- Check database is running in Render dashboard
- Ensure migrations ran successfully

### Google Sheets Access Denied

- Verify service account email has access to sheet
- Check `PRIVATE_KEY` formatting (keep `\n` characters)
- Ensure all Google credentials are set

### Scheduled Reminders Not Working

Render's free tier doesn't support cron jobs. Options:

1. **Upgrade to paid plan** - Enable cron jobs
2. **Use external scheduler:**
   - [cron-job.org](https://cron-job.org) (free)
   - Set up to hit: `https://your-app.onrender.com/send-reminders/` (requires creating an endpoint)
3. **GitHub Actions** - Run scheduled workflow that triggers your management command

## üí∞ Render Free Tier Limitations

- **Web Service:**
  - Spins down after 15 minutes of inactivity
  - First request after spin-down takes ~30 seconds
  - 750 hours/month free

- **Database:**
  - 1GB storage
  - Automatically backed up
  - 90-day retention

- **No Cron Jobs** (requires paid plan)

## üîÑ Continuous Deployment

Render automatically redeploys when you push to your main branch:

```bash
git add .
git commit -m "Update feature"
git push
```

Deployment will start automatically!

## üìö Useful Commands

### View Logs
```bash
# Real-time
Render Dashboard ‚Üí Service ‚Üí Logs

# Or use Render CLI
render logs -f
```

### Run Management Commands
```bash
# In Render shell
cd finance_alert
python manage.py <command>
```

### Restart Service
```bash
# Render Dashboard ‚Üí Service ‚Üí Manual Deploy ‚Üí "Deploy latest commit"
```

## üÜò Support

- **Render Docs:** [render.com/docs](https://render.com/docs)
- **Django Deployment:** [docs.djangoproject.com/en/5.1/howto/deployment/](https://docs.djangoproject.com/en/5.1/howto/deployment/)
- **Status Page:** [status.render.com](https://status.render.com)

## üéâ Success!

Your app should now be live at: `https://your-app-name.onrender.com`

Remember to:
- Update SITE_ID domain in Django admin
- Test all features in production
- Monitor logs for any errors
- Set up email if using reminders

---

**Happy Deploying!** üöÄ
